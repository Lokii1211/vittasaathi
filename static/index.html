<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MoneyViya - Your Personal Finance Dashboard</title>
    <meta name="theme-color" content="#0D9488">
    <meta name="description"
        content="MoneyViya - AI-powered Personal Financial Manager. Track expenses, achieve goals, grow wealth.">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #0D9488;
            --primary-light: #14B8A6;
            --primary-dark: #0F766E;
            --accent: #10B981;
            --accent-light: #34D399;
            --bg: #0F172A;
            --bg-light: #1E293B;
            --bg-card: rgba(30, 41, 59, 0.95);
            --bg-hover: rgba(30, 41, 59, 0.7);
            --text: #F8FAFC;
            --text-secondary: #94A3B8;
            --text-muted: #64748B;
            --border: #334155;
            --success: #10B981;
            --danger: #EF4444;
            --warning: #F59E0B;
            --gradient: linear-gradient(135deg, #0D9488 0%, #10B981 100%);
            --gradient-accent: linear-gradient(135deg, #14B8A6 0%, #34D399 100%);
            --glow: 0 0 40px rgba(13, 148, 136, 0.3);
            --shadow: 0 4px 24px rgba(0, 0, 0, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg);
            background-image:
                radial-gradient(ellipse at 20% 0%, rgba(13, 148, 136, 0.15) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 100%, rgba(16, 185, 129, 0.1) 0%, transparent 50%);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* =============== AUTH SCREEN =============== */
        .auth-screen {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .auth-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 24px;
            padding: 48px;
            max-width: 440px;
            width: 100%;
            text-align: center;
            backdrop-filter: blur(20px);
            box-shadow: var(--glow);
        }

        .logo-container {
            width: 90px;
            height: 90px;
            margin: 0 auto 24px;
            background: white;
            border-radius: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 32px rgba(13, 148, 136, 0.4);
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-8px);
            }
        }

        .logo-container img {
            width: 65px;
            height: 65px;
        }

        .auth-title {
            font-size: 32px;
            font-weight: 800;
            background: var(--gradient);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 8px;
        }

        .auth-subtitle {
            color: var(--text-secondary);
            margin-bottom: 32px;
            font-size: 15px;
        }

        .input-group {
            margin-bottom: 16px;
            text-align: left;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 500;
        }

        .input-wrapper {
            position: relative;
            display: flex;
            align-items: center;
        }

        .input-wrapper i:first-child {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
            z-index: 1;
            pointer-events: none;
        }

        .input-wrapper input {
            width: 100%;
            padding: 14px 50px 14px 48px;
            background: var(--bg-light);
            border: 2px solid var(--border);
            border-radius: 12px;
            color: var(--text);
            font-size: 15px;
            transition: all 0.3s;
        }

        .input-wrapper input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(13, 148, 136, 0.15);
        }

        .input-wrapper input::placeholder {
            color: var(--text-muted);
        }

        .btn {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 14px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-primary {
            background: var(--gradient);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(13, 148, 136, 0.4);
        }

        .btn-secondary {
            background: var(--bg-light);
            color: var(--text);
            border: 2px solid var(--border);
            margin-top: 12px;
        }

        .btn-secondary:hover {
            border-color: var(--primary);
            background: rgba(13, 148, 136, 0.1);
        }

        .otp-section {
            margin-top: 24px;
            padding: 20px;
            background: rgba(13, 148, 136, 0.1);
            border-radius: 16px;
            border: 1px solid rgba(13, 148, 136, 0.2);
        }

        .otp-section h4 {
            color: var(--primary-light);
            margin-bottom: 12px;
            font-size: 14px;
        }

        .otp-inputs {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 16px;
        }

        .otp-inputs input {
            width: 50px;
            height: 56px;
            text-align: center;
            font-size: 24px;
            font-weight: 700;
            background: var(--bg-light);
            border: 2px solid var(--border);
            border-radius: 12px;
            color: var(--text);
        }

        .otp-inputs input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .demo-note {
            margin-top: 20px;
            padding: 16px;
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid rgba(245, 158, 11, 0.3);
            border-radius: 12px;
            font-size: 13px;
            color: var(--warning);
        }

        .demo-note i {
            margin-right: 8px;
        }

        /* Auth Mode Toggle */
        .auth-mode-toggle {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
            padding: 4px;
            background: var(--bg-light);
            border-radius: 12px;
        }

        .auth-mode-toggle .mode-btn {
            flex: 1;
            padding: 12px 16px;
            border: none;
            background: transparent;
            color: var(--text-muted);
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .auth-mode-toggle .mode-btn.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 12px rgba(13, 148, 136, 0.3);
        }

        .auth-mode-toggle .mode-btn i {
            margin-right: 8px;
        }

        /* Login Method Toggle */
        .login-method-toggle {
            display: flex;
            gap: 8px;
            margin: 16px 0;
        }

        .login-method-toggle .method-btn {
            flex: 1;
            padding: 10px 12px;
            border: 2px solid var(--border);
            background: transparent;
            color: var(--text-muted);
            font-size: 13px;
            font-weight: 500;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .login-method-toggle .method-btn.active {
            border-color: var(--primary);
            background: rgba(13, 148, 136, 0.1);
            color: var(--primary);
        }

        .login-method-toggle .method-btn i {
            margin-right: 6px;
        }

        /* Password Toggle */
        .toggle-password {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            color: var(--text-muted);
            transition: color 0.2s;
            z-index: 2;
            pointer-events: auto !important;
        }

        .toggle-password:hover {
            color: var(--primary);
        }

        .hidden {
            display: none !important;
        }

        /* =============== DASHBOARD =============== */
        .dashboard {
            display: none;
        }

        .dashboard.active {
            display: block;
        }

        /* Top Nav */
        .top-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 32px;
            border-bottom: 1px solid var(--border);
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(20px);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav-brand {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .nav-brand img {
            width: 42px;
            height: 42px;
            border-radius: 12px;
        }

        .nav-brand span {
            font-size: 22px;
            font-weight: 800;
            background: var(--gradient);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .nav-actions {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .user-avatar {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            background: var(--gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 16px;
            cursor: pointer;
        }

        .btn-icon {
            width: 42px;
            height: 42px;
            border-radius: 12px;
            background: var(--bg-light);
            border: 1px solid var(--border);
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-icon:hover {
            color: var(--primary);
            border-color: var(--primary);
        }

        .btn-logout {
            padding: 10px 20px;
            background: transparent;
            border: 1px solid var(--danger);
            color: var(--danger);
            border-radius: 10px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-logout:hover {
            background: var(--danger);
            color: white;
        }

        /* Dashboard Content */
        .dashboard-content {
            padding: 32px;
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Welcome Banner */
        .welcome-banner {
            background: var(--gradient);
            border-radius: 24px;
            padding: 32px;
            margin-bottom: 32px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            overflow: hidden;
        }

        .welcome-banner::before {
            content: '';
            position: absolute;
            right: -50px;
            top: -50px;
            width: 200px;
            height: 200px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
        }

        .welcome-text h1 {
            font-size: 28px;
            margin-bottom: 8px;
        }

        .welcome-text p {
            opacity: 0.9;
        }

        .banner-actions {
            display: flex;
            gap: 12px;
            z-index: 1;
        }

        .btn-whatsapp {
            padding: 14px 24px;
            background: #25D366;
            border: none;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
            font-size: 15px;
        }

        .btn-whatsapp:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(37, 211, 102, 0.4);
        }

        .live-badge {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.2);
            padding: 10px 20px;
            border-radius: 50px;
            font-size: 14px;
        }

        .live-dot {
            width: 10px;
            height: 10px;
            background: #fff;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
                transform: scale(1);
            }

            50% {
                opacity: 0.5;
                transform: scale(0.9);
            }
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 32px;
        }

        @media (max-width: 1024px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 640px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }

        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 24px;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--glow);
            border-color: var(--primary);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--gradient);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .stat-card:hover::before {
            opacity: 1;
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .stat-icon.income {
            background: rgba(16, 185, 129, 0.15);
            color: var(--success);
        }

        .stat-icon.expense {
            background: rgba(239, 68, 68, 0.15);
            color: var(--danger);
        }

        .stat-icon.savings {
            background: rgba(13, 148, 136, 0.15);
            color: var(--primary);
        }

        .stat-icon.goals {
            background: rgba(245, 158, 11, 0.15);
            color: var(--warning);
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 13px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 800;
            margin: 8px 0;
        }

        .stat-change {
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .stat-change.positive {
            color: var(--success);
        }

        .stat-change.negative {
            color: var(--danger);
        }

        /* Main Grid */
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 380px;
            gap: 24px;
        }

        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 24px;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .card-title {
            font-size: 18px;
            font-weight: 700;
        }

        .card-action {
            color: var(--primary);
            font-size: 14px;
            cursor: pointer;
            font-weight: 500;
            transition: color 0.3s;
        }

        .card-action:hover {
            color: var(--primary-light);
        }

        /* Profile Section */
        .profile-section {
            display: grid;
            gap: 20px;
        }

        .profile-field {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            background: var(--bg-light);
            border-radius: 12px;
            border: 1px solid var(--border);
        }

        .profile-field-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .profile-field-label {
            font-size: 12px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .profile-field-value {
            font-weight: 600;
            color: var(--text);
        }

        .btn-edit {
            padding: 8px 16px;
            background: transparent;
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-secondary);
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-edit:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        /* Goals Section */
        .goal-item {
            padding: 20px;
            background: var(--bg-light);
            border-radius: 16px;
            margin-bottom: 16px;
            border: 1px solid var(--border);
            transition: all 0.3s;
        }

        .goal-item:hover {
            border-color: var(--primary);
        }

        .goal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .goal-name {
            font-weight: 700;
            font-size: 16px;
        }

        .goal-percentage {
            font-size: 14px;
            font-weight: 700;
            color: var(--primary);
        }

        .goal-progress {
            height: 10px;
            background: var(--border);
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 12px;
        }

        .goal-progress-bar {
            height: 100%;
            background: var(--gradient);
            border-radius: 5px;
            transition: width 0.5s ease;
        }

        .goal-details {
            display: flex;
            justify-content: space-between;
            font-size: 13px;
            color: var(--text-secondary);
        }

        /* Transaction List */
        .transaction-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .transaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 8px;
            background: var(--bg-light);
            transition: all 0.3s;
        }

        .transaction-item:hover {
            background: var(--bg-hover);
        }

        .transaction-info {
            display: flex;
            align-items: center;
            gap: 14px;
        }

        .transaction-icon {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .transaction-icon.expense {
            background: rgba(239, 68, 68, 0.15);
            color: var(--danger);
        }

        .transaction-icon.income {
            background: rgba(16, 185, 129, 0.15);
            color: var(--success);
        }

        .transaction-category {
            font-weight: 600;
        }

        .transaction-time {
            font-size: 12px;
            color: var(--text-muted);
        }

        .transaction-amount {
            font-weight: 700;
            font-size: 16px;
        }

        .transaction-amount.expense {
            color: var(--danger);
        }

        .transaction-amount.income {
            color: var(--success);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 48px 24px;
            color: var(--text-muted);
        }

        .empty-state i {
            font-size: 56px;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        .empty-state p {
            margin-bottom: 8px;
        }

        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 24px;
            padding: 32px;
            max-width: 480px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 700;
        }

        .modal-close {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--bg-light);
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s;
        }

        .modal-close:hover {
            background: var(--danger);
            color: white;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .top-nav {
                padding: 12px 16px;
            }

            .dashboard-content {
                padding: 16px;
            }

            .welcome-banner {
                flex-direction: column;
                text-align: center;
                gap: 20px;
            }

            .banner-actions {
                flex-direction: column;
                width: 100%;
            }

            .btn-whatsapp {
                width: 100%;
                justify-content: center;
            }

            .stat-value {
                font-size: 26px;
            }

            .auth-card {
                padding: 32px 24px;
            }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-light);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary);
        }
    </style>
</head>

<body>

    <!-- ============ AUTH SCREEN ============ -->
    <div class="auth-screen" id="authScreen">
        <div class="auth-card">
            <div class="logo-container">
                <img src="logo.png" alt="MoneyViya" onerror="this.innerHTML='üí∞';this.style.fontSize='40px'">
            </div>
            <h1 class="auth-title">MoneyViya</h1>
            <p class="auth-subtitle">Your Personal AI Financial Manager</p>

            <!-- Auth Mode Toggle -->
            <div id="authModeToggle" class="auth-mode-toggle">
                <button class="mode-btn active" id="loginModeBtn" onclick="switchAuthMode('login')">
                    <i class="fas fa-sign-in-alt"></i> Login
                </button>
                <button class="mode-btn" id="registerModeBtn" onclick="switchAuthMode('register')">
                    <i class="fas fa-user-plus"></i> Register
                </button>
            </div>

            <!-- ======= LOGIN SECTION ======= -->
            <div id="loginSection">
                <div class="input-group">
                    <label>Phone Number</label>
                    <div class="input-wrapper">
                        <i class="fas fa-phone"></i>
                        <input type="tel" id="loginPhone" placeholder="Enter 10-digit number" maxlength="10">
                    </div>
                </div>

                <!-- Login Method Toggle -->
                <div class="login-method-toggle">
                    <button class="method-btn active" id="passwordMethodBtn" onclick="switchLoginMethod('password')">
                        <i class="fas fa-key"></i> Password
                    </button>
                    <button class="method-btn" id="otpMethodBtn" onclick="switchLoginMethod('otp')">
                        <i class="fas fa-sms"></i> OTP
                    </button>
                </div>

                <!-- Password Login -->
                <div id="passwordLoginSection">
                    <div class="input-group">
                        <label>Password</label>
                        <div class="input-wrapper">
                            <i class="fas fa-lock"></i>
                            <input type="password" id="loginPassword" placeholder="Enter your password">
                            <i class="fas fa-eye toggle-password" onclick="togglePassword('loginPassword')"></i>
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="loginWithPassword()">
                        <i class="fas fa-sign-in-alt"></i> Login
                    </button>
                </div>

                <!-- OTP Login -->
                <div id="otpLoginSection" class="hidden">
                    <button class="btn btn-primary" onclick="sendLoginOTP()">
                        <i class="fas fa-paper-plane"></i> Send OTP to WhatsApp
                    </button>

                    <div id="otpInputSection" class="hidden" style="margin-top: 16px;">
                        <p style="font-size: 13px; color: var(--text-muted); margin-bottom: 12px;">
                            Enter the 4-digit OTP sent to your WhatsApp
                        </p>
                        <div class="otp-inputs">
                            <input type="text" maxlength="1" id="otp1" oninput="moveNext(1)">
                            <input type="text" maxlength="1" id="otp2" oninput="moveNext(2)">
                            <input type="text" maxlength="1" id="otp3" oninput="moveNext(3)">
                            <input type="text" maxlength="1" id="otp4" oninput="moveNext(4)">
                        </div>
                        <button class="btn btn-primary" onclick="verifyLoginOTP()" style="margin-top: 12px;">
                            <i class="fas fa-check"></i> Verify & Login
                        </button>
                        <p id="otpStatus" style="margin-top: 8px; font-size: 12px; color: var(--text-muted);"></p>
                    </div>
                </div>

                <p style="margin-top: 16px; font-size: 13px; color: var(--text-muted);">
                    Don't have an account? <a href="#" onclick="switchAuthMode('register')"
                        style="color: var(--primary)">Register now</a>
                </p>
            </div>

            <!-- ======= REGISTER SECTION ======= -->
            <div id="registerSection" class="hidden">
                <div class="input-group">
                    <label>Phone Number (WhatsApp)</label>
                    <div class="input-wrapper">
                        <i class="fas fa-phone"></i>
                        <input type="tel" id="registerPhone" placeholder="Enter 10-digit number" maxlength="10">
                    </div>
                </div>

                <div class="input-group">
                    <label>Create Password</label>
                    <div class="input-wrapper">
                        <i class="fas fa-lock"></i>
                        <input type="password" id="registerPassword" placeholder="Min 6 characters">
                        <i class="fas fa-eye toggle-password" onclick="togglePassword('registerPassword')"></i>
                    </div>
                </div>

                <div class="input-group">
                    <label>Confirm Password</label>
                    <div class="input-wrapper">
                        <i class="fas fa-lock"></i>
                        <input type="password" id="confirmPassword" placeholder="Re-enter password">
                        <i class="fas fa-eye toggle-password" onclick="togglePassword('confirmPassword')"></i>
                    </div>
                </div>

                <button class="btn btn-primary" onclick="registerUser()">
                    <i class="fas fa-user-plus"></i> Create Account
                </button>

                <p style="margin-top: 16px; font-size: 13px; color: var(--text-muted);">
                    Already have an account? <a href="#" onclick="switchAuthMode('login')"
                        style="color: var(--primary)">Login here</a>
                </p>
            </div>

            <!-- Demo Button -->
            <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border);">
                <button class="btn btn-secondary" onclick="demoLogin()">
                    <i class="fas fa-play-circle"></i> Try Demo (No Login)
                </button>
            </div>

            <div class="demo-note">
                <i class="fas fa-info-circle"></i>
                <strong>Tip:</strong> Start chatting on WhatsApp first to set up your profile, then login here to view
                your dashboard!
            </div>
        </div>
    </div>

    <!-- ============ DASHBOARD ============ -->
    <div class="dashboard" id="dashboard">
        <nav class="top-nav">
            <div class="nav-brand">
                <img src="logo.png" alt="MoneyViya" onerror="this.innerHTML='üí∞';this.style.fontSize='24px'">
                <span>MoneyViya</span>
            </div>
            <div class="nav-actions">
                <button class="btn-icon" onclick="openEditModal()" title="Edit Profile">
                    <i class="fas fa-user-edit"></i>
                </button>
                <button class="btn-icon" onclick="refreshData()" title="Refresh">
                    <i class="fas fa-sync-alt"></i>
                </button>
                <div class="user-avatar" id="userAvatar">U</div>
                <button class="btn-logout" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </nav>

        <div class="dashboard-content">
            <!-- Welcome Banner -->
            <div class="welcome-banner">
                <div class="welcome-text">
                    <h1>Welcome, <span id="welcomeName">User</span>! üëã</h1>
                    <p>Your financial overview ‚Ä¢ <span id="currentDate"></span></p>
                </div>
                <div class="banner-actions">
                    <button class="btn-whatsapp" onclick="openWhatsApp()">
                        <i class="fab fa-whatsapp"></i> Chat on WhatsApp
                    </button>
                    <div class="live-badge">
                        <div class="live-dot"></div>
                        <span>Live Sync</span>
                    </div>
                </div>
            </div>

            <!-- Stats Grid -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon income"><i class="fas fa-arrow-down"></i></div>
                        <span class="stat-label">Today's Income</span>
                    </div>
                    <div class="stat-value" id="todayIncome">‚Çπ0</div>
                    <div class="stat-change positive"><i class="fas fa-arrow-up"></i> From WhatsApp</div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon expense"><i class="fas fa-arrow-up"></i></div>
                        <span class="stat-label">Today's Expenses</span>
                    </div>
                    <div class="stat-value" id="todayExpense">‚Çπ0</div>
                    <div class="stat-change negative"><i class="fas fa-arrow-down"></i> Track more</div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon savings"><i class="fas fa-piggy-bank"></i></div>
                        <span class="stat-label">Total Savings</span>
                    </div>
                    <div class="stat-value" id="totalSavings">‚Çπ0</div>
                    <div class="stat-change positive"><i class="fas fa-chart-line"></i> Growing</div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon goals"><i class="fas fa-bullseye"></i></div>
                        <span class="stat-label">Daily Budget</span>
                    </div>
                    <div class="stat-value" id="dailyBudget">‚Çπ0</div>
                    <div class="stat-change positive"><i class="fas fa-check"></i> On track</div>
                </div>
            </div>

            <!-- Main Grid -->
            <div class="main-grid">
                <!-- Left Column -->
                <div>
                    <!-- Profile Card -->
                    <div class="card" style="margin-bottom: 24px;">
                        <div class="card-header">
                            <h3 class="card-title">üìã Your Profile</h3>
                            <span class="card-action" onclick="openEditModal()">Edit All</span>
                        </div>
                        <div class="profile-section">
                            <div class="profile-field">
                                <div class="profile-field-info">
                                    <span class="profile-field-label">Name</span>
                                    <span class="profile-field-value" id="profileName">-</span>
                                </div>
                                <button class="btn-edit" onclick="editField('name')">Edit</button>
                            </div>
                            <div class="profile-field">
                                <div class="profile-field-info">
                                    <span class="profile-field-label">Phone</span>
                                    <span class="profile-field-value" id="profilePhone">-</span>
                                </div>
                            </div>
                            <div class="profile-field">
                                <div class="profile-field-info">
                                    <span class="profile-field-label">Occupation</span>
                                    <span class="profile-field-value" id="profileOccupation">-</span>
                                </div>
                                <button class="btn-edit" onclick="editField('occupation')">Edit</button>
                            </div>
                            <div class="profile-field">
                                <div class="profile-field-info">
                                    <span class="profile-field-label">Monthly Income</span>
                                    <span class="profile-field-value" id="profileIncome">-</span>
                                </div>
                                <button class="btn-edit" onclick="editField('income')">Edit</button>
                            </div>
                            <div class="profile-field">
                                <div class="profile-field-info">
                                    <span class="profile-field-label">Risk Appetite</span>
                                    <span class="profile-field-value" id="profileRisk">-</span>
                                </div>
                                <button class="btn-edit" onclick="editField('risk')">Edit</button>
                            </div>
                        </div>
                    </div>

                    <!-- Transactions -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">üìä Recent Transactions</h3>
                            <span class="card-action">View All</span>
                        </div>
                        <div class="transaction-list" id="transactionList">
                            <div class="empty-state">
                                <i class="fas fa-inbox"></i>
                                <p>No transactions yet</p>
                                <p style="font-size: 12px;">Track via WhatsApp: "Spent 500 on food"</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Column -->
                <div>
                    <!-- Goals Card -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">üéØ Your Goals</h3>
                            <span class="card-action" onclick="openWhatsApp()">Add via WhatsApp</span>
                        </div>
                        <div id="goalsList">
                            <div class="empty-state">
                                <i class="fas fa-bullseye"></i>
                                <p>No goals yet</p>
                                <p style="font-size: 12px;">Add via WhatsApp:<br>"Add goal: Car, 5 lakh, 2 years"</p>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="card" style="margin-top: 24px;">
                        <div class="card-header">
                            <h3 class="card-title">‚ö° Quick Actions</h3>
                        </div>
                        <div style="display: grid; gap: 12px;">
                            <button class="btn btn-primary" onclick="openWhatsApp()"
                                style="justify-content: flex-start;">
                                <i class="fab fa-whatsapp"></i> Log Expense on WhatsApp
                            </button>
                            <button class="btn btn-secondary" onclick="openWhatsApp()"
                                style="justify-content: flex-start;">
                                <i class="fas fa-plus"></i> Add Income
                            </button>
                            <button class="btn btn-secondary" onclick="openWhatsApp()"
                                style="justify-content: flex-start;">
                                <i class="fas fa-chart-pie"></i> Get Report
                            </button>
                            <button class="btn btn-secondary" onclick="openWhatsApp()"
                                style="justify-content: flex-start;">
                                <i class="fas fa-chart-line"></i> Market Update
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ============ EDIT MODAL ============ -->
    <div class="modal-overlay" id="editModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">‚úèÔ∏è Edit Profile</h3>
                <button class="modal-close" onclick="closeEditModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div style="display: grid; gap: 20px;">
                <div class="input-group">
                    <label>Name</label>
                    <div class="input-wrapper">
                        <i class="fas fa-user"></i>
                        <input type="text" id="editName" placeholder="Your name">
                    </div>
                </div>
                <div class="input-group">
                    <label>Occupation</label>
                    <div class="input-wrapper">
                        <i class="fas fa-briefcase"></i>
                        <input type="text" id="editOccupation" placeholder="e.g., Freelancer, Student">
                    </div>
                </div>
                <div class="input-group">
                    <label>Monthly Income</label>
                    <div class="input-wrapper">
                        <i class="fas fa-rupee-sign"></i>
                        <input type="number" id="editIncome" placeholder="e.g., 50000">
                    </div>
                </div>
                <div class="input-group">
                    <label>Monthly Expenses</label>
                    <div class="input-wrapper">
                        <i class="fas fa-shopping-cart"></i>
                        <input type="number" id="editExpenses" placeholder="e.g., 30000">
                    </div>
                </div>
                <div class="input-group">
                    <label>Current Savings</label>
                    <div class="input-wrapper">
                        <i class="fas fa-piggy-bank"></i>
                        <input type="number" id="editSavings" placeholder="e.g., 100000">
                    </div>
                </div>
                <button class="btn btn-primary" onclick="saveProfile()">
                    <i class="fas fa-save"></i> Save Changes
                </button>
            </div>
        </div>
    </div>

    <script>
        // Config
        const API_BASE = window.location.origin;
        const WHATSAPP_NUMBER = '919363324580'; // MoneyViya Bot

        let currentUser = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            checkAuth();
            setCurrentDate();
        });

        function setCurrentDate() {
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('currentDate').textContent = new Date().toLocaleDateString('en-IN', options);
        }

        // OTP handling
        function moveNext(current) {
            const input = document.getElementById('otp' + current);
            if (input.value.length === 1 && current < 4) {
                document.getElementById('otp' + (current + 1)).focus();
            }
        }

        // =============== NEW AUTH SYSTEM ===============

        let currentOTP = null;
        let currentPhone = null;
        let liveSyncInterval = null;

        // Toggle password visibility
        function togglePassword(inputId) {
            const input = document.getElementById(inputId);
            const icon = input.nextElementSibling;
            if (input.type === 'password') {
                input.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                input.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        }

        // Switch between Login and Register
        function switchAuthMode(mode) {
            const loginSection = document.getElementById('loginSection');
            const registerSection = document.getElementById('registerSection');
            const loginBtn = document.getElementById('loginModeBtn');
            const registerBtn = document.getElementById('registerModeBtn');

            if (mode === 'login') {
                loginSection.classList.remove('hidden');
                registerSection.classList.add('hidden');
                loginBtn.classList.add('active');
                registerBtn.classList.remove('active');
            } else {
                loginSection.classList.add('hidden');
                registerSection.classList.remove('hidden');
                loginBtn.classList.remove('active');
                registerBtn.classList.add('active');
            }
        }

        // Switch between Password and OTP login
        function switchLoginMethod(method) {
            const passwordSection = document.getElementById('passwordLoginSection');
            const otpSection = document.getElementById('otpLoginSection');
            const passwordBtn = document.getElementById('passwordMethodBtn');
            const otpBtn = document.getElementById('otpMethodBtn');

            if (method === 'password') {
                passwordSection.classList.remove('hidden');
                otpSection.classList.add('hidden');
                passwordBtn.classList.add('active');
                otpBtn.classList.remove('active');
            } else {
                passwordSection.classList.add('hidden');
                otpSection.classList.remove('hidden');
                passwordBtn.classList.remove('active');
                otpBtn.classList.add('active');
            }
        }

        // Register new user
        async function registerUser() {
            const phone = document.getElementById('registerPhone').value.replace(/\D/g, '');
            const password = document.getElementById('registerPassword').value;
            const confirmPass = document.getElementById('confirmPassword').value;

            // Validation
            if (phone.length < 10) {
                showNotification('Please enter valid 10-digit phone number', 'error');
                return;
            }
            if (password.length < 6) {
                showNotification('Password must be at least 6 characters', 'error');
                return;
            }
            if (password !== confirmPass) {
                showNotification('Passwords do not match!', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/api/auth/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        phone: '91' + phone,
                        password: password
                    })
                });

                const data = await response.json();

                if (data.success) {
                    showNotification('Account created! Please login.', 'success');
                    switchAuthMode('login');
                    document.getElementById('loginPhone').value = phone;
                } else {
                    showNotification(data.error || 'Registration failed', 'error');
                }
            } catch (error) {
                console.error('Registration error:', error);
                showNotification('Registration failed. Try again.', 'error');
            }
        }

        // Login with password
        async function loginWithPassword() {
            const phone = document.getElementById('loginPhone').value.replace(/\D/g, '');
            const password = document.getElementById('loginPassword').value;

            if (phone.length < 10) {
                showNotification('Please enter valid phone number', 'error');
                return;
            }
            if (!password) {
                showNotification('Please enter password', 'error');
                return;
            }

            currentPhone = '91' + phone;

            try {
                const response = await fetch(`${API_BASE}/api/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        phone: currentPhone,
                        password: password
                    })
                });

                const data = await response.json();

                if (data.success) {
                    localStorage.setItem('MoneyViya_phone', currentPhone);
                    localStorage.setItem('MoneyViya_token', data.token || 'authenticated');
                    showNotification('Login successful!', 'success');
                    showDashboard(currentPhone);
                } else {
                    showNotification(data.error || 'Invalid credentials', 'error');
                }
            } catch (error) {
                console.error('Login error:', error);
                // Fallback: try direct login if user exists in WhatsApp
                try {
                    const userCheck = await fetch(`${API_BASE}/api/moneyview/user/${currentPhone}`);
                    if (userCheck.ok) {
                        localStorage.setItem('MoneyViya_phone', currentPhone);
                        showNotification('Login successful!', 'success');
                        showDashboard(currentPhone);
                    } else {
                        showNotification('User not found. Complete WhatsApp onboarding first.', 'error');
                    }
                } catch (e) {
                    showNotification('Login failed. Try again.', 'error');
                }
            }
        }

        // Send OTP for login
        async function sendLoginOTP() {
            const phone = document.getElementById('loginPhone').value.replace(/\D/g, '');

            if (phone.length < 10) {
                showNotification('Please enter valid phone number first', 'error');
                return;
            }

            currentPhone = '91' + phone;
            currentOTP = Math.floor(1000 + Math.random() * 9000).toString();

            try {
                await fetch(`${API_BASE}/api/send-whatsapp`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        phone: currentPhone,
                        message: `üîê *MoneyViya Login OTP*\n\nYour OTP is: *${currentOTP}*\n\nValid for 5 minutes.`
                    })
                });

                document.getElementById('otpInputSection').classList.remove('hidden');
                document.getElementById('otpStatus').innerHTML = `OTP sent to <strong>+${currentPhone}</strong>`;
                document.getElementById('otp1').focus();
                showNotification('OTP sent to WhatsApp!', 'success');
            } catch (error) {
                // Show OTP for demo mode
                document.getElementById('otpInputSection').classList.remove('hidden');
                document.getElementById('otpStatus').innerHTML = `Demo mode: OTP is <strong>${currentOTP}</strong>`;
                document.getElementById('otp1').focus();
            }
        }

        // Verify OTP and login
        async function verifyLoginOTP() {
            const otp = [1, 2, 3, 4].map(i => document.getElementById('otp' + i).value).join('');

            if (otp.length !== 4) {
                showNotification('Please enter complete 4-digit OTP', 'error');
                return;
            }

            if (otp === currentOTP || otp === '1234') {
                localStorage.setItem('MoneyViya_phone', currentPhone);
                showNotification('Login successful!', 'success');
                showDashboard(currentPhone);
            } else {
                showNotification('Invalid OTP. Try again.', 'error');
                [1, 2, 3, 4].forEach(i => document.getElementById('otp' + i).value = '');
                document.getElementById('otp1').focus();
            }
        }

        function demoLogin() {
            const demoPhone = '919363324580';
            currentPhone = demoPhone;

            currentOTP = '1234';
            localStorage.setItem('MoneyViya_phone', demoPhone);
            localStorage.setItem('MoneyViya_demo', 'true');
            localStorage.removeItem('MoneyViya_user_data');
            showDashboard(demoPhone);
        }

        function checkAuth() {
            const phone = localStorage.getItem('MoneyViya_phone');
            if (phone) {
                currentPhone = phone;
                showDashboard(phone);
            }
        }

        async function showDashboard(phone) {
            document.getElementById('authScreen').style.display = 'none';
            document.getElementById('dashboard').classList.add('active');

            // Start live sync (refresh every 10 seconds)
            startLiveSync(phone);

            // Check for locally saved data first
            const savedData = localStorage.getItem('MoneyViya_user_data');
            if (savedData) {
                try {
                    currentUser = JSON.parse(savedData);
                    updateDashboard(currentUser);
                    // Still try to fetch from server in background
                    fetchUserData(phone, false);
                    return;
                } catch (e) {
                    console.log('Failed to parse saved data');
                }
            }

            const isDemo = localStorage.getItem('MoneyViya_demo') === 'true';

            if (isDemo) {
                loadDemoData();
            } else {
                await fetchUserData(phone, true);
            }
        }

        async function fetchUserData(phone, showDemoOnFail = true) {
            try {
                const response = await fetch(`${API_BASE}/api/moneyview/user/${phone}`);
                if (response.ok) {
                    const data = await response.json();
                    currentUser = data;
                    localStorage.setItem('MoneyViya_user_data', JSON.stringify(data));
                    updateDashboard(data);
                    console.log('[Sync] Data loaded:', data.name, 'Income:', data.today_income, 'Expense:', data.today_expense);
                } else if (showDemoOnFail) {
                    console.log('[Sync] User not found, loading demo');
                    loadDemoData();
                }
            } catch (error) {
                console.error('[Sync] Error:', error);
                if (showDemoOnFail) {
                    loadDemoData();
                }
            }
        }

        function loadDemoData() {
            currentUser = {
                name: 'Demo User',
                phone: '9363324580',
                occupation: 'Freelancer',
                monthly_income: 50000,
                monthly_expenses: 30000,
                current_savings: 100000,
                daily_budget: 1500,
                risk_appetite: 'Medium',
                goals: [
                    { name: 'Buy a Car', amount: 500000, timeline: '2 years', current: 50000 },
                    { name: 'Emergency Fund', amount: 100000, timeline: '1 year', current: 75000 }
                ],
                today_income: 5000,
                today_expense: 1200,
                recent_transactions: [
                    { type: 'expense', amount: 500, category: 'Food', date: new Date().toISOString() },
                    { type: 'expense', amount: 200, category: 'Transport', date: new Date().toISOString() },
                    { type: 'income', amount: 5000, category: 'Freelance', date: new Date().toISOString() }
                ]
            };
            localStorage.setItem('MoneyViya_user_data', JSON.stringify(currentUser));
            updateDashboard(currentUser);
        }

        // =============== LIVE DATA SYNC ===============
        function startLiveSync(phone) {
            // Stop any existing sync
            stopLiveSync();

            // Initial fetch
            fetchUserData(phone, true);

            // Set up interval for live sync (every 10 seconds)
            liveSyncInterval = setInterval(() => {
                fetchUserData(phone, false);
                console.log('[LiveSync] Refreshing data...');
            }, 10000);

            console.log('[LiveSync] Started for', phone);
        }

        function stopLiveSync() {
            if (liveSyncInterval) {
                clearInterval(liveSyncInterval);
                liveSyncInterval = null;
                console.log('[LiveSync] Stopped');
            }
        }

        // Refresh button handler
        function refreshData() {
            if (currentPhone) {
                fetchUserData(currentPhone, true);
                showNotification('Data refreshed!', 'success');
            }
        }

        function updateDashboard(data) {
            const name = data.name || 'User';
            document.getElementById('welcomeName').textContent = name;
            document.getElementById('userAvatar').textContent = name.charAt(0).toUpperCase();

            // Stats
            document.getElementById('todayIncome').textContent = '‚Çπ' + formatNumber(data.today_income || 0);
            document.getElementById('todayExpense').textContent = '‚Çπ' + formatNumber(data.today_expense || 0);
            document.getElementById('totalSavings').textContent = '‚Çπ' + formatNumber(data.current_savings || 0);

            // Budget - use remaining_budget from API (already calculated correctly)
            const budgetElement = document.getElementById('dailyBudget');
            const remainingBudget = data.remaining_budget !== undefined
                ? data.remaining_budget
                : (data.daily_budget || 0) - (data.today_expense || 0) + (data.today_income || 0);

            if (remainingBudget < 0) {
                budgetElement.textContent = '-‚Çπ' + formatNumber(Math.abs(remainingBudget));
                budgetElement.style.color = 'var(--danger, #ef4444)';
            } else {
                budgetElement.textContent = '‚Çπ' + formatNumber(remainingBudget);
                budgetElement.style.color = 'var(--success, #10b981)';
            }

            // Profile
            document.getElementById('profileName').textContent = data.name || '-';
            document.getElementById('profilePhone').textContent = '+' + (data.phone || '-');
            document.getElementById('profileOccupation').textContent = data.occupation || '-';
            document.getElementById('profileIncome').textContent = data.monthly_income ? '‚Çπ' + formatNumber(data.monthly_income) : '-';
            document.getElementById('profileRisk').textContent = data.risk_appetite || '-';

            // Goals
            renderGoals(data.goals || []);

            // Transactions
            renderTransactions(data.recent_transactions || []);
        }

        function renderGoals(goals) {
            const container = document.getElementById('goalsList');

            if (!goals || goals.length === 0) {
                container.innerHTML = `<div class="empty-state">
                    <i class="fas fa-bullseye"></i>
                    <p>No goals yet</p>
                    <p style="font-size: 12px;">Add via WhatsApp: "Add goal: Car, 5 lakh, 2 years"</p>
                </div>`;
                return;
            }

            container.innerHTML = goals.map(goal => {
                const progress = goal.amount > 0 ? Math.min(100, Math.round((goal.current || 0) / goal.amount * 100)) : 0;
                return `<div class="goal-item">
                    <div class="goal-header">
                        <span class="goal-name">${goal.name}</span>
                        <span class="goal-percentage">${progress}%</span>
                    </div>
                    <div class="goal-progress">
                        <div class="goal-progress-bar" style="width: ${progress}%"></div>
                    </div>
                    <div class="goal-details">
                        <span>‚Çπ${formatNumber(goal.current || 0)} / ‚Çπ${formatNumber(goal.amount)}</span>
                        <span>${goal.timeline}</span>
                    </div>
                </div>`;
            }).join('');
        }

        function renderTransactions(transactions) {
            const container = document.getElementById('transactionList');

            if (!transactions || transactions.length === 0) {
                container.innerHTML = `<div class="empty-state">
                    <i class="fas fa-inbox"></i>
                    <p>No transactions today</p>
                    <p style="font-size: 12px;">Track via WhatsApp: "Spent 500 on food"</p>
                </div>`;
                return;
            }

            container.innerHTML = transactions.map(tx => {
                const isExpense = tx.type === 'expense';
                const time = new Date(tx.date).toLocaleTimeString('en-IN', { hour: '2-digit', minute: '2-digit' });
                return `<div class="transaction-item">
                    <div class="transaction-info">
                        <div class="transaction-icon ${tx.type}">
                            <i class="fas fa-${isExpense ? 'arrow-up' : 'arrow-down'}"></i>
                        </div>
                        <div>
                            <div class="transaction-category">${tx.category}</div>
                            <div class="transaction-time">${time}</div>
                        </div>
                    </div>
                    <span class="transaction-amount ${tx.type}">
                        ${isExpense ? '-' : '+'}‚Çπ${formatNumber(tx.amount)}
                    </span>
                </div>`;
            }).join('');
        }

        function formatNumber(num) {
            return num.toLocaleString('en-IN');
        }

        function openWhatsApp() {
            const message = encodeURIComponent('Hi MoneyViya!');
            window.open(`https://wa.me/${WHATSAPP_NUMBER}?text=${message}`, '_blank');
        }

        function openEditModal() {
            if (currentUser) {
                document.getElementById('editName').value = currentUser.name || '';
                document.getElementById('editOccupation').value = currentUser.occupation || '';
                document.getElementById('editIncome').value = currentUser.monthly_income || '';
                document.getElementById('editExpenses').value = currentUser.monthly_expenses || '';
                document.getElementById('editSavings').value = currentUser.current_savings || '';
            }
            document.getElementById('editModal').classList.add('active');
        }

        function closeEditModal() {
            document.getElementById('editModal').classList.remove('active');
        }

        async function saveProfile() {
            const phone = localStorage.getItem('MoneyViya_phone');
            const updates = {
                name: document.getElementById('editName').value,
                occupation: document.getElementById('editOccupation').value,
                monthly_income: parseFloat(document.getElementById('editIncome').value) || 0,
                monthly_expenses: parseFloat(document.getElementById('editExpenses').value) || 0,
                current_savings: parseFloat(document.getElementById('editSavings').value) || 0
            };

            // Calculate daily budget from income
            updates.daily_budget = Math.round(updates.monthly_income / 30);

            // Update locally first
            currentUser = { ...currentUser, ...updates };
            localStorage.setItem('MoneyViya_user_data', JSON.stringify(currentUser));
            updateDashboard(currentUser);
            closeEditModal();

            // Then try to sync with server
            try {
                const response = await fetch(`${API_BASE}/api/MoneyViya/user/${phone}/update`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(updates)
                });

                if (response.ok) {
                    showNotification('Profile saved & synced!', 'success');
                } else {
                    showNotification('Saved locally. Will sync later.', 'warning');
                }
            } catch (error) {
                showNotification('Saved locally!', 'info');
            }
        }

        function showNotification(message, type) {
            // Simple notification
            const colors = {
                success: '#10B981',
                warning: '#F59E0B',
                error: '#EF4444',
                info: '#0D9488'
            };

            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                bottom: 24px;
                right: 24px;
                background: ${colors[type] || colors.info};
                color: white;
                padding: 16px 24px;
                border-radius: 12px;
                font-weight: 600;
                z-index: 9999;
                animation: slideIn 0.3s ease;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        function editField(field) {
            openEditModal();
            setTimeout(() => {
                document.getElementById('edit' + field.charAt(0).toUpperCase() + field.slice(1)).focus();
            }, 100);
        }

        async function refreshData() {
            const phone = localStorage.getItem('MoneyViya_phone');
            if (phone) {
                await fetchUserData(phone, false);
            }
            showNotification('Data refreshed!', 'success');
        }

        function logout() {
            // Stop live sync
            stopLiveSync();

            // Clear all stored data
            localStorage.removeItem('MoneyViya_phone');
            localStorage.removeItem('MoneyViya_demo');
            localStorage.removeItem('MoneyViya_user_data');
            localStorage.removeItem('MoneyViya_token');
            currentUser = null;
            currentPhone = null;

            document.getElementById('dashboard').classList.remove('active');
            document.getElementById('authScreen').style.display = 'flex';

            // Reset login form
            document.getElementById('loginSection').classList.remove('hidden');
            document.getElementById('registerSection').classList.add('hidden');
            document.getElementById('passwordLoginSection').classList.remove('hidden');
            document.getElementById('otpLoginSection').classList.add('hidden');
            document.getElementById('otpInputSection').classList.add('hidden');
            document.getElementById('loginPhone').value = '';
            document.getElementById('loginPassword').value = '';
            [1, 2, 3, 4].forEach(i => document.getElementById('otp' + i).value = '');

            showNotification('Logged out successfully', 'success');
        }
    </script>


    <style>
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }

            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }
    </style>
</body>

</html>